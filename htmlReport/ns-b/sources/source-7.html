


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > ReportConsole</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">oopassignment.ui</a>
</div>

<h1>Coverage Summary for Class: ReportConsole (oopassignment.ui)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">ReportConsole</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/47)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/128)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package oopassignment.ui;
&nbsp;
&nbsp;import java.time.LocalDate;
&nbsp;import java.time.LocalDateTime;
&nbsp;import java.time.format.DateTimeFormatter;
&nbsp;import java.time.format.DateTimeParseException;
&nbsp;import java.util.List;
&nbsp;import oopassignment.domain.order.TransactionHeader;
&nbsp;import oopassignment.domain.auth.EmployeeRecord;
&nbsp;import oopassignment.domain.auth.Role;
&nbsp;import oopassignment.domain.report.MemberPurchase;
&nbsp;import oopassignment.domain.report.SalesSummary;
&nbsp;import oopassignment.service.EmployeeService;
&nbsp;import oopassignment.service.ReportService;
&nbsp;import oopassignment.util.ApplicationContext;
&nbsp;import java.util.LinkedHashMap;
&nbsp;import java.util.Map;
&nbsp;
&nbsp;import static oopassignment.ui.BootsDo.*;
&nbsp;
<b class="nc">&nbsp;public class ReportConsole {</b>
&nbsp;
<b class="nc">&nbsp;    private static final ReportService reportService = ApplicationContext.REPORT_SERVICE;</b>
<b class="nc">&nbsp;    private static final EmployeeService employeeService = ApplicationContext.EMPLOYEE_SERVICE;</b>
<b class="nc">&nbsp;    private static final DateTimeFormatter DATETIME_FORMATTER = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;);</b>
&nbsp;
&nbsp;    public static void showMenu() {
<b class="nc">&nbsp;        int opt = 0;</b>
&nbsp;        do {
<b class="nc">&nbsp;            System.out.println(&quot;&quot;&quot;</b>
&nbsp;                              
&nbsp;                               Report Menu
&nbsp;                               1. Employee salary
&nbsp;                               2. Member purchase history
&nbsp;                               3. Sales summary
&nbsp;                               4. Staff by manager
&nbsp;                               5. Return to Main Menu
&nbsp;                               &quot;&quot;&quot;);
<b class="nc">&nbsp;            opt = readIntInRange(&quot;Option &gt; &quot;, 1, 5);</b>
<b class="nc">&nbsp;            switch (opt) {</b>
<b class="nc">&nbsp;                case 1 -&gt; employeeSalary();</b>
<b class="nc">&nbsp;                case 2 -&gt; memberPurchase();</b>
<b class="nc">&nbsp;                case 3 -&gt; salesSummary();</b>
<b class="nc">&nbsp;                case 4 -&gt; staffByManager();</b>
&nbsp;                case 5 -&gt; { }
<b class="nc">&nbsp;                default -&gt; System.out.println(ANSI_RED + &quot;Invalid input, please enter a number between 1 and 5 !!!&quot; + ANSI_BLACK);</b>
&nbsp;            }
<b class="nc">&nbsp;        } while (opt != 5);</b>
&nbsp;    }
&nbsp;    
&nbsp;
&nbsp;    private static void employeeSalary() {
<b class="nc">&nbsp;        Role role = readRole();</b>
<b class="nc">&nbsp;        double min = readDouble(&quot;Min salary: &quot;, 0.0);</b>
<b class="nc">&nbsp;        double max = readDouble(&quot;Max salary: &quot;, min);</b>
&nbsp;    
&nbsp;        List&lt;EmployeeRecord&gt; list;
&nbsp;        try {
<b class="nc">&nbsp;            list = employeeService.listByRole(role);</b>
&nbsp;        } catch (Exception ex) {
<b class="nc">&nbsp;            System.out.println(ANSI_RED + ex.getMessage() + ANSI_BLACK);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;    
<b class="nc">&nbsp;        String border   = &quot;+--------+--------------+------------+&quot;;</b>
<b class="nc">&nbsp;        String headerFm = &quot;| %-6s | %-12s | %-10s |%n&quot;;</b>
<b class="nc">&nbsp;        String rowFm    = &quot;| %-6s | %-12s | %10.2f |%n&quot;;</b>
&nbsp;    
<b class="nc">&nbsp;        System.out.println();</b>
<b class="nc">&nbsp;        System.out.println(&quot;Employees in range&quot;);</b>
<b class="nc">&nbsp;        System.out.println(border);</b>
<b class="nc">&nbsp;        System.out.printf(headerFm, &quot;ID&quot;, &quot;Username&quot;, &quot;Salary&quot;);</b>
<b class="nc">&nbsp;        System.out.println(border);</b>
&nbsp;    
<b class="nc">&nbsp;        boolean any = false;</b>
<b class="nc">&nbsp;        for (EmployeeRecord e : list) {</b>
<b class="nc">&nbsp;            double salary = employeeService.calculateSalary(e);</b>
<b class="nc">&nbsp;            if (salary &gt;= min &amp;&amp; salary &lt;= max) {</b>
<b class="nc">&nbsp;                any = true;</b>
<b class="nc">&nbsp;                System.out.printf(</b>
&nbsp;                        rowFm,
<b class="nc">&nbsp;                        e.getId(),</b>
<b class="nc">&nbsp;                        e.getUsername(),</b>
<b class="nc">&nbsp;                        salary</b>
&nbsp;                );
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (!any) {</b>
<b class="nc">&nbsp;            System.out.println(&quot;(No employees in range)&quot;);</b>
&nbsp;        }
&nbsp;    
<b class="nc">&nbsp;        System.out.println(border);</b>
&nbsp;    }
&nbsp;    
&nbsp;
&nbsp;    private static void staffByManager() {
&nbsp;        List&lt;EmployeeRecord&gt; managers;
&nbsp;        List&lt;EmployeeRecord&gt; staff;
&nbsp;        try {
<b class="nc">&nbsp;            managers = employeeService.listByRole(Role.MANAGER);</b>
<b class="nc">&nbsp;            staff = employeeService.listByRole(Role.STAFF);</b>
&nbsp;        } catch (Exception ex) {
<b class="nc">&nbsp;            System.out.println(ANSI_RED + ex.getMessage() + ANSI_BLACK);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        Map&lt;String, String&gt; managerLabels = new LinkedHashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        for (EmployeeRecord m : managers) {</b>
<b class="nc">&nbsp;            managerLabels.put(m.getId(), m.getId() + &quot; (&quot; + m.getUsername() + &quot;)&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        String border   = &quot;+----------------------+----------+--------------+&quot;;</b>
<b class="nc">&nbsp;        String headerFm = &quot;| %-20s | %-8s | %-12s |%n&quot;;</b>
<b class="nc">&nbsp;        String rowFm    = &quot;| %-20s | %-8s | %-12s |%n&quot;;</b>
&nbsp;
<b class="nc">&nbsp;        System.out.println();</b>
<b class="nc">&nbsp;        System.out.println(&quot;Staff by Manager&quot;);</b>
<b class="nc">&nbsp;        System.out.println(border);</b>
<b class="nc">&nbsp;        System.out.printf(headerFm, &quot;Manager&quot;, &quot;Staff ID&quot;, &quot;Username&quot;);</b>
<b class="nc">&nbsp;        System.out.println(border);</b>
&nbsp;
<b class="nc">&nbsp;        if (staff.isEmpty()) {</b>
<b class="nc">&nbsp;            System.out.println(&quot;(No staff found)&quot;);</b>
<b class="nc">&nbsp;            System.out.println(border);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        for (EmployeeRecord s : staff) {</b>
<b class="nc">&nbsp;            String mgrId = s.getUplineId();</b>
&nbsp;            String label;
<b class="nc">&nbsp;            if (mgrId == null || mgrId.isBlank()) {</b>
<b class="nc">&nbsp;                label = &quot;Unassigned&quot;;</b>
&nbsp;            } else {
<b class="nc">&nbsp;                label = managerLabels.getOrDefault(mgrId, mgrId + &quot; (unknown)&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            System.out.printf(rowFm, label, s.getId(), s.getUsername());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        System.out.println(border);</b>
&nbsp;    }
&nbsp;
&nbsp;    private static void memberPurchase() {
<b class="nc">&nbsp;        String memberId = readRequiredLine(&quot;Member ID: &quot;);</b>
&nbsp;        List&lt;MemberPurchase&gt; purchases;
&nbsp;        try {
<b class="nc">&nbsp;            purchases = reportService.getMemberPurchaseHistory(memberId);</b>
&nbsp;        } catch (Exception ex) {
<b class="nc">&nbsp;            System.out.println(ANSI_RED + ex.getMessage() + ANSI_BLACK);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;    
<b class="nc">&nbsp;        if (purchases.isEmpty()) {</b>
<b class="nc">&nbsp;            System.out.println(&quot;No purchases&quot;);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;    
<b class="nc">&nbsp;        String border   = &quot;+---------------------+------------+------------+&quot;;</b>
<b class="nc">&nbsp;        String headerFm = &quot;| %-19s | %-10s | %-10s |%n&quot;;</b>
<b class="nc">&nbsp;        String rowFm    = &quot;| %-19s | %10.2f | %-10s |%n&quot;;</b>
&nbsp;    
<b class="nc">&nbsp;        System.out.println();</b>
<b class="nc">&nbsp;        System.out.println(&quot;Purchase history for &quot; + memberId);</b>
<b class="nc">&nbsp;        System.out.println(border);</b>
<b class="nc">&nbsp;        System.out.printf(headerFm, &quot;DateTime&quot;, &quot;Amount&quot;, &quot;Payment&quot;);</b>
<b class="nc">&nbsp;        System.out.println(border);</b>
&nbsp;    
<b class="nc">&nbsp;        for (MemberPurchase p : purchases) {</b>
<b class="nc">&nbsp;            String formattedDateTime = p.getDateTime().format(DATETIME_FORMATTER);</b>
<b class="nc">&nbsp;            System.out.printf(</b>
&nbsp;                rowFm,
&nbsp;                formattedDateTime,
<b class="nc">&nbsp;                p.getAmount(),</b>
<b class="nc">&nbsp;                p.getPaymentMethod()</b>
&nbsp;                //&quot;N/A&quot;
&nbsp;            );
&nbsp;        }
&nbsp;    
<b class="nc">&nbsp;        System.out.println(border);</b>
&nbsp;        }
&nbsp;    
&nbsp;
&nbsp;    private static void salesSummary() {
<b class="nc">&nbsp;        LocalDate from = readDateStrict(&quot;From (yyyy-MM-dd): &quot;);</b>
<b class="nc">&nbsp;        LocalDate to = readDateStrict(&quot;To   (yyyy-MM-dd): &quot;);</b>
<b class="nc">&nbsp;        if (to.isBefore(from)) {</b>
<b class="nc">&nbsp;            System.out.println(ANSI_RED + &quot;End date must not be earlier than start date.&quot; + ANSI_BLACK);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;        
&nbsp;        List&lt;TransactionHeader&gt; transactions;
&nbsp;        SalesSummary summary;
&nbsp;        try {
<b class="nc">&nbsp;            transactions = reportService.getTransactionsInRange(from, to);</b>
<b class="nc">&nbsp;            summary = reportService.getSalesSummary(from, to);</b>
&nbsp;        } catch (Exception ex) {
<b class="nc">&nbsp;            System.out.println(ANSI_RED + ex.getMessage() + ANSI_BLACK);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;    
<b class="nc">&nbsp;        if (transactions.isEmpty()) {</b>
<b class="nc">&nbsp;            System.out.println(ANSI_YELLOW + &quot;\nNo transactions found for the selected date range.&quot; + ANSI_BLACK);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;    
&nbsp;        // Display detailed transaction list
<b class="nc">&nbsp;        String border = &quot;+------------+---------------------+------------+------------+------------+------------+&quot;;</b>
<b class="nc">&nbsp;        String headerFm = &quot;| %-10s | %-19s | %-10s | %-10s | %-10s | %10s |%n&quot;;</b>
<b class="nc">&nbsp;        String rowFm    = &quot;| %-10s | %-19s | %-10s | %-10s | %-10s | %10.2f |%n&quot;;</b>
&nbsp;    
<b class="nc">&nbsp;        System.out.println();</b>
<b class="nc">&nbsp;        System.out.println(ANSI_CYAN + &quot;Sales Summary: &quot; + from + &quot; to &quot; + to + ANSI_BLACK);</b>
<b class="nc">&nbsp;        System.out.println();</b>
<b class="nc">&nbsp;        System.out.println(&quot;Transaction Details:&quot;);</b>
<b class="nc">&nbsp;        System.out.println(border);</b>
<b class="nc">&nbsp;        System.out.printf(headerFm, &quot;Trans ID&quot;, &quot;DateTime&quot;, &quot;Member ID&quot;, &quot;Customer ID&quot;, &quot;Payment&quot;, &quot;Amount&quot;);</b>
<b class="nc">&nbsp;        System.out.println(border);</b>
&nbsp;    
<b class="nc">&nbsp;        for (TransactionHeader t : transactions) {</b>
<b class="nc">&nbsp;            String formattedDateTime = t.getDateTime().format(DATETIME_FORMATTER);</b>
<b class="nc">&nbsp;            String memberId = t.getMemberId() != null &amp;&amp; !t.getMemberId().isBlank() ? t.getMemberId() : &quot;N/A&quot;;</b>
<b class="nc">&nbsp;            String customerId = t.getCustomerId() != null &amp;&amp; !t.getCustomerId().isBlank() ? t.getCustomerId() : &quot;N/A&quot;;</b>
<b class="nc">&nbsp;            String paymentMethod = t.getPaymentMethod() != null &amp;&amp; !t.getPaymentMethod().isBlank() ? t.getPaymentMethod() : &quot;N/A&quot;;</b>
<b class="nc">&nbsp;            System.out.printf(</b>
&nbsp;                rowFm,
<b class="nc">&nbsp;                t.getTransactionId(),</b>
&nbsp;                formattedDateTime,
&nbsp;                memberId,
&nbsp;                customerId,
&nbsp;                paymentMethod,
<b class="nc">&nbsp;                t.getTotalAmount()</b>
&nbsp;            );
&nbsp;        }
<b class="nc">&nbsp;        System.out.println(border);</b>
&nbsp;        
&nbsp;        // Display summary section
<b class="nc">&nbsp;        System.out.println();</b>
<b class="nc">&nbsp;        System.out.println(ANSI_CYAN + &quot;Summary:&quot; + ANSI_BLACK);</b>
<b class="nc">&nbsp;        String summaryBorder = &quot;+--------------------------------+------------+------------+------------+&quot;;</b>
<b class="nc">&nbsp;        String summaryHeaderFm = &quot;| %-30s | %-10s | %-10s | %-10s |%n&quot;;</b>
<b class="nc">&nbsp;        String summaryRowFm    = &quot;| %-30s | %10.2f | %10d | %10.2f |%n&quot;;</b>
&nbsp;        
<b class="nc">&nbsp;        System.out.println(summaryBorder);</b>
<b class="nc">&nbsp;        System.out.printf(summaryHeaderFm, &quot;Period&quot;, &quot;Total&quot;, &quot;Count&quot;, &quot;Avg&quot;);</b>
<b class="nc">&nbsp;        System.out.println(summaryBorder);</b>
<b class="nc">&nbsp;        System.out.printf(</b>
&nbsp;            summaryRowFm,
&nbsp;            from + &quot; to &quot; + to,
<b class="nc">&nbsp;            summary.getTotalAmount(),</b>
<b class="nc">&nbsp;            summary.getTransactionCount(),</b>
<b class="nc">&nbsp;            summary.getAveragePerTransaction()</b>
&nbsp;        );
<b class="nc">&nbsp;        System.out.println(summaryBorder);</b>
&nbsp;    }
&nbsp;    
&nbsp;
&nbsp;    private static LocalDate readDateStrict(String prompt) {
&nbsp;        while (true) {
&nbsp;            try {
<b class="nc">&nbsp;                return LocalDate.parse(readRequiredLine(prompt));</b>
&nbsp;            } catch (DateTimeParseException ex) {
<b class="nc">&nbsp;                System.out.println(ANSI_RED + &quot;Invalid date format (expected yyyy-MM-dd).&quot; + ANSI_BLACK);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private static Role readRole() {
&nbsp;        while (true) {
<b class="nc">&nbsp;            String roleStr = readRequiredLine(&quot;Role (MANAGER/STAFF): &quot;);</b>
&nbsp;            try {
<b class="nc">&nbsp;                return Role.valueOf(roleStr.toUpperCase());</b>
&nbsp;            } catch (IllegalArgumentException ex) {
<b class="nc">&nbsp;                System.out.println(ANSI_RED + &quot;Unknown role. Please enter MANAGER or STAFF.&quot; + ANSI_BLACK);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-12-12 10:09</div>
</div>
</body>
</html>
